#!/usr/bin/env bash
set -o nounset
# set -o xtrace

error() {
        msg=$1
        >&2 echo "$0: ${msg}."
        exit 1
}

if [[ $# -ne 1 ]]; then
        error "missing package argument"
fi

# Check that adb sees exactly 1 device
if [ $(adb devices | wc -l) -ne 3 ]; then
        error "adb must see exactly 1 device"
fi

prefix="package:"
match=$(echo $(adb shell pm list packages | grep -m 1 -s "$1") | tr -d '\r')

# Check that package exists
if [ -z "$match" ]; then
        error "invalid argument: package '$1' not found"
fi

package=${match#${prefix}}
echo $package
